#Copyright 2023, Battelle Energy Alliance, LLC

import sys
import json

malwareList = []
fileList = []
relDict = {}

#Check for elements in object
def reqCheck(bundle):
    for object in bundle['objects']:
        if object['type'] == 'malware':
            malwareList.append(object['id'])
        elif object['type'] == 'file':
            fileList.append(object['id'])
        elif object['type'] == 'relationship':
            if object['source_ref'].startswith('malware--') and object['target_ref'].startswith('file--'):
                relDict[object['source_ref']] = object['target_ref']
    
    for malware in malwareList:
        if malware in relDict.keys():
            if relDict[malware] in fileList:
                pass
            else:
                print("    " + malware + " is missing associated file object")
        else:
            print("    " + malware + " is missing associated relationship and file objects")

#------------------------------------------------------------------------------

print('Malware/File Objects Requirement Checker...')

#Check arguments
try:
    bundle_input = sys.argv[1]
except:
    print('Argument Missing')
    sys.exit()
 
#Load json files
with open(bundle_input, 'r', encoding='utf-8', errors='replace') as f:
    bundle = json.load(f)

#print(bundle)
#print()

reqCheck(bundle)

print('Malware/File Objects Requirement Checker...Done')